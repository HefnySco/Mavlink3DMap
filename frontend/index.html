<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mavlink 3D Map</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/src/css/styles.css">
</head>
  <body class="home-body">
    <main class="home-page">
      <section class="home-hero">
        <div class="home-brand">
          <h1 class="home-title">Mavlink 3D Map</h1>
          <p class="home-subtitle">Launch a rich four-view 3D control room for your drone missions, or slim it down to a single view when you just need the essentials.</p>
          <div class="home-hero-actions">
            <ul class="home-demo-list">
              <li>
                <a href="./index_4w_map_box.html">
                  <span class="home-demo-primary">Mapbox world</span>
                  <span class="home-demo-meta">Real Flat World</span>
                </a>
              </li>
              <li>
                <a href="./index_4w_real_map.html">
                  <span class="home-demo-primary">Real map world</span>
                  <span class="home-demo-meta">3D map</span>
                </a>
              </li>
              <li>
                <a href="./index_4w.html">
                  <span class="home-demo-primary">Green / grass world</span>
                  <span class="home-demo-meta">artificial</span>
                </a>
              </li>
            </ul>

            <div class="home-select">
              <span class="home-select-label">Views</span>
              <div class="home-select-control">
                <select id="select_view_count" class="home-select-input">
                  <option value="1" class="home-option-input">1</option>
                  <option value="2" class="home-option-input">2</option>
                  <option value="4" class="home-option-input">4</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        <div class="home-visual">
          <div class="home-visual-frame">
            <img class="home-logo" src="/app_logo.png" alt="Mavlink 3D Map logo" />
          </div>
        </div>
      </section>

      <section class="home-controls">
        <div>
          <h2 class="home-section-title">Control Center</h2>
          <p class="home-section-subtitle">Customize your scene before the telemetry starts flowing.</p>
        </div>

        <div class="home-controls-grid">
          <label class="home-toggle" for="toggle_buildings">
            <input type="checkbox" id="toggle_buildings">
            <span>Create buildings</span>
          </label>

          <label class="home-toggle" for="toggle_vehicles">
            <input type="checkbox" id="toggle_vehicles">
            <span>Create vehicles</span>
          </label>

          <label class="home-toggle" for="toggle_physics">
            <input type="checkbox" id="toggle_physics">
            <span>Enable physics (balls & collisions)</span>
          </label>
        </div>

        <div class="home-select-group">
          <div class="home-select">
            <span class="home-select-label">Quad type</span>
            <div class="home-select-control">
              <select id="select_quad_type" class="home-select-input">
                <option value="normal" class='home-option-input'>Normal</option>
                <option value="tailsitter" class='home-option-input'>TailSitter</option>
              </select>
            </div>
          </div>
        </div>
      </section>

      <section class="home-howto">
        <div>
          <h2 class="home-section-title">Documentation</h2>
          <p class="home-section-subtitle">For setup guides and run commands, open the project README on GitHub.</p>
        </div>

        <a class="home-doc-link" href="https://github.com/HefnySco/Mavlink3DMap#readme" target="_blank" rel="noopener noreferrer">
          <span class="home-doc-link-label">Open README</span>
          <span class="home-doc-link-meta">github.com/HefnySco/Mavlink3DMap</span>
        </a>
      </section>

      <section class="home-shortcuts-section">
        <div>
          <h2 class="home-section-title">Keyboard shortcuts</h2>
          <p class="home-shortcuts-hint">Stay efficient as you command and monitor every view.</p>
        </div>
        <div id="shortcuts_list"></div>
      </section>
    </main>
    <script>
      (function() {
        const KEY = 'BUILDINGS_PER_TILE';
        const DEFAULT_VALUE = 'false';

        try {
          const current = window.localStorage.getItem(KEY);
          if (current === null) {
            window.localStorage.setItem(KEY, DEFAULT_VALUE);
          }
          window.BUILDINGS_PER_TILE = window.localStorage.getItem(KEY) || DEFAULT_VALUE;
        } catch (e) {
          window.BUILDINGS_PER_TILE = DEFAULT_VALUE;
        }
      })();
    </script>
    <script type="module">
      import { HELP_SHORTCUTS_HTML } from '/src/js/help_text.js';
      import {
        getBuildingsPerTileFlag,
        getPhysicsEnabledFlag,
        getRandomVehiclesEnabledFlag,
        getQuadType,
        getStringFromStorage,
        setBoolInStorage,
        setStringInStorage
      } from '/src/js/js_storage.js';

      
      const toggleVehicles = document.getElementById('toggle_vehicles');
      if (toggleVehicles) {
        try {
          toggleVehicles.checked = getRandomVehiclesEnabledFlag();
        } catch (e) {
          toggleVehicles.checked = true;
        }

        toggleVehicles.addEventListener('change', () => {
          const checked = !!toggleVehicles.checked;
          setBoolInStorage('RANDOM_VEHICLES_ENABLED', checked);
        });
      }

      const toggleBuildings = document.getElementById('toggle_buildings');
      if (toggleBuildings) {
        try {
          toggleBuildings.checked = getBuildingsPerTileFlag();
        } catch (e) {
          toggleBuildings.checked = true;
        }

        toggleBuildings.addEventListener('change', () => {
          const checked = !!toggleBuildings.checked;
          setBoolInStorage('BUILDINGS_PER_TILE', checked);
        });
      }

      const togglePhysics = document.getElementById('toggle_physics');
      if (togglePhysics) {
        try {
          togglePhysics.checked = getPhysicsEnabledFlag();
        } catch (e) {
          togglePhysics.checked = false;
        }

        togglePhysics.addEventListener('change', () => {
          const checked = !!togglePhysics.checked;
          setBoolInStorage('PHYSICS_ENABLED', checked);
        });
      }

      const quadTypeSelect = document.getElementById('select_quad_type');
      if (quadTypeSelect) {
        const stored = getQuadType();
        if (stored) {
          const normalized = stored.toLowerCase();
          quadTypeSelect.value = normalized === 'tailsitter' ? 'tailsitter' : 'normal';
        }

        quadTypeSelect.addEventListener('change', () => {
          const selected = quadTypeSelect.value || 'normal';
          setStringInStorage('QUAD_TYPE', selected);
        });
      }

      const viewCountSelect = document.getElementById('select_view_count');
      if (viewCountSelect) {
        const applyDemoLinks = (value) => {
          const v = String(value || '4');
          document.querySelectorAll('.demo-links a').forEach((a) => {
            if (!a.dataset.baseHref) {
              a.dataset.baseHref = a.getAttribute('href') || '';
            }
            const baseHref = a.dataset.baseHref;
            const u = new URL(baseHref, window.location.href);
            u.searchParams.set('views', v);
            a.setAttribute('href', u.pathname + u.search);
          });
        };

        const stored = getStringFromStorage('VIEW_COUNT', '4');
        const normalized = stored === '1' || stored === '2' || stored === '4' ? stored : '4';
        viewCountSelect.value = normalized;
        applyDemoLinks(normalized);

        viewCountSelect.addEventListener('change', () => {
          const selected = viewCountSelect.value || '4';
          setStringInStorage('VIEW_COUNT', selected);
          applyDemoLinks(selected);
        });
      }

      const el = document.getElementById('shortcuts_list');
      if (el) el.innerHTML = HELP_SHORTCUTS_HTML;
    </script>
  </body>
</html>